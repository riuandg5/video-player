<!DOCTYPE html>
<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <meta name="viewport" content="width=1024" />
        <meta http-equiv="X-UA-Compatible" content="ie=edge" />
        <title>Video Player</title>
        <link
            rel="stylesheet"
            href="https://use.fontawesome.com/releases/v5.5.0/css/all.css"
            integrity="sha384-B4dIYHKNBt8Bc12p+WXckhzcICo0wtJAoU8YZTY5qE0Id1GSseTk6S+L3BlXeVIU"
            crossorigin="anonymous"
        />
        <style>
            @import url("https://fonts.googleapis.com/css?family=Montserrat");

            * {
                margin: 0;
                padding: 0;
                box-sizing: border-box;
                text-decoration: none;
                font-family: "Montserrat", sans-serif;
                color: white;
            }

            body {
                width: 100vw;
                height: 100vh;
                overflow: hidden;
                background-color: black;
            }

            i {
                cursor: pointer;
            }

            #video-container {
                width: 100%;
                height: 100%;
                display: flex;
                align-items: center;
            }

            #video-figure {
                position: relative;
            }

            #video-figure,
            #video,
            #video-controls {
                width: 100vw;
                height: 56.25vw;
                /* max-width: 177.78vh; */
                max-height: 100vh;
                color: white;
            }

            #video-controls {
                position: absolute;
                top: 0;
                display: flex;
                flex-direction: column;
                justify-content: space-between;
                background-color: rgba(0, 0, 0, 0.5);
            }

            #video-controls-top,
            #video-controls-mid,
            #video-controls-bottom {
                width: 100%;
                text-align: center;
            }

            #video-controls-top {
                font-size: 25px;
                opacity: 1;
                transition: opacity 0.5s;
            }

            #video-controls-top,
            #video-controls-bottom {
                padding: 0.8em 2em;
            }

            #video-controls-mid {
                display: flex;
                justify-content: center;
                align-items: center;
                opacity: 1;
                transition: opacity 0.5s;
            }

            #play-pause {
                font-size: 7em;
                margin: 0 0.8em;
            }

            #backward,
            #forward {
                font-size: 4em;
                color: rgba(255, 255, 255, 0.8);
            }

            #video-controls-bottom {
                opacity: 1;
                transition: opacity 0.5s;
            }

            #video-controls:hover #video-controls-top,
            #video-controls:hover #video-controls-mid,
            #video-controls:hover #video-controls-bottom {
                opacity: 1;
                transition: opacity 0.5s;
            }

            #video-time {
                float: left;
                font-size: 25px;
            }

            #right-control {
                float: right;
            }

            #pitch,
            #volume {
                font-size: 25px;
                margin-left: 15px;
            }

            #mute-unmute {
                width: 25px;
                vertical-align: -0.5px;
                margin-right: 10px;
                cursor: pointer;
            }

            #pitch-bar,
            #volume-bar,
            #seek-bar {
                -webkit-appearance: none;
                appearance: none;
                outline: none;
                background-color: rgba(200, 200, 200, 0.8);
                transition: background-color 0.2s;
            }

            #pitch-bar:hover,
            #volume-bar:hover,
            #seek-bar:hover {
                background-color: rgba(200, 200, 200, 1);
                transition: background-color 0.2s;
            }

            #pitch-bar,
            #volume-bar {
                width: 100px;
                height: 4px;
                border-radius: 2px;
                vertical-align: 7px;
            }

            #seek-bar {
                width: 100%;
                height: 8px;
                margin-top: 12px;
                border-radius: 4px;
            }

            #pitch-bar::-webkit-slider-thumb,
            #volume-bar::-webkit-slider-thumb,
            #seek-bar::-webkit-slider-thumb {
                -webkit-appearance: none;
                appearance: none;
                border-radius: 50%;
                box-shadow: 0px 0px 4px 4px rgba(255, 255, 255, 0.3);
                background: white;
                cursor: pointer;
            }

            #pitch-bar::-webkit-slider-thumb,
            #volume-bar::-webkit-slider-thumb {
                width: 12px;
                height: 12px;
            }

            #seek-bar::-webkit-slider-thumb {
                width: 22px;
                height: 22px;
            }

            #fullscreen {
                font-size: 25px;
                vertical-align: -0.5px;
                color: white;
                transform: rotate(45deg);
                cursor: pointer;
                margin-left: 15px;
            }

            #pitch-mode,
            #playback-speed {
                display: inline-block;
                position: relative;
                width: 75px;
                height: 25px;
                text-align: center;
                border: 1px solid white;
                vertical-align: -4px;
                cursor: pointer;
                margin-left: 15px;
            }

            #pitch-mode {
                width: 120px;
                margin-left: 0;
            }

            #current-mode,
            #current-speed {
                position: absolute;
                top: 0;
                left: 0;
                width: 75px;
                height: 25px;
                font-size: 20px;
                line-height: 1.1;
                color: white;
            }

            #current-mode {
                width: 120px;
            }

            #mode-options,
            #speed-options {
                visibility: hidden;
                opacity: 0;
                transition: all 0.5s;
                position: absolute;
                top: -242px;
                left: -1px;
                width: 75px;
                height: 242px;
                border: 1px solid white;
            }

            #mode-options {
                width: 120px;
                height: 60px;
                top: -60px;
                left: -1px;
            }

            #pitch-mode:hover #mode-options,
            #playback-speed:hover #speed-options {
                visibility: visible;
                opacity: 1;
                transition: all 0.5s;
            }

            .mode,
            .speed {
                height: 30px;
                font-size: 20px;
                line-height: 1.5;
                color: white;
            }

            .mode:hover,
            .speed:hover {
                background-color: rgba(255, 255, 255, 0.2);
            }

            .mode:not(:last-child),
            .speed:not(:last-child) {
                border-bottom: 1px solid white;
            }

            .menu {
                position: absolute;
                top: 0;
                width: 25%;
                height: 56.25vw;
                max-height: 100vh;
                padding: 20px;
                background-color: rgba(0, 0, 0, 0.5);
                opacity: 0;
                transition: all 0.5s;
            }

            .menu:hover {
                opacity: 1;
                transition: all 0.5s;
            }

            #menu-right {
                right: -24.5%;
                transition: all 0.5s;
                padding-right: 15px;
                display: flex;
                flex-direction: column;
                color: white;
            }

            #menu-right:hover {
                right: 0;
            }

            #inputs {
                width: 100%;
                font-size: 35px;
                line-height: 1;
                display: flex;
                padding-bottom: 20px;
            }

            #url-input {
                flex-grow: 1;
                width: 100%;
                height: 35px;
                vertical-align: 6.8px;
                font-size: 18px;
                padding: 0 15px;
                outline: none;
                border: 2px solid white;
                border-radius: 17.5px;
                background-color: transparent;
                color: white;
            }

            #url-input::placeholder {
                color: rgba(255, 255, 255, 0.8);
            }

            #slash {
                padding: 0 8px;
                font-weight: bold;
            }

            #file-input {
                display: none;
            }

            #playlist {
                flex-grow: 1;
                list-style: none;
                overflow-y: auto;
                overflow-x: hidden;
            }

            #playlist::-webkit-scrollbar {
                width: 6px;
            }

            #playlist::-webkit-scrollbar-thumb {
                background-color: rgba(255, 255, 255, 0.5);
                border-radius: 3px;
            }

            .list-item {
                display: flex;
                max-height: 46px;
                margin-top: 0px;
                border-top: 1px solid rgba(255, 255, 255, 0.3);
                padding: 5px 0;
                padding-right: 10px;
                margin-right: 5px;
            }

            .list-item:first-child {
                max-height: 45px;
                border: none;
            }

            .list-item:hover {
                max-height: none;
                border-color: transparent;
                background-color: rgba(255, 255, 255, 0.3);
            }

            .item-index {
                flex: 0 0 50px;
                text-align: center;
                font-size: 20px;
                line-height: 1.75;
                color: rgba(255, 255, 255, 0.8);
            }

            .item-index i {
                font-size: 30px;
                vertical-align: -5px;
                color: white;
            }

            .item-index .hidden {
                display: none;
            }

            .item-name {
                flex: 1 0;
                overflow: hidden;
                white-space: nowrap;
                font-size: 20px;
                line-height: 1.75;
            }

            .item-name:hover {
                white-space: normal;
            }

            #playlist-options {
                width: 100%;
                font-size: 35px;
                line-height: 1;
                text-align: center;
                letter-spacing: 10px;
                padding-top: 20px;
                color: white;
            }
        </style>
        <script src="AudioUtil.js"></script>
    </head>

    <body>
        <div id="video-container">
            <div id="video-figure">
                <video id="video" poster></video>
                <div id="video-controls">
                    <div id="video-controls-top">
                        Move cursor to extreme right to view playlist
                    </div>
                    <div id="video-controls-mid">
                        <i id="backward" class="fas fa-undo"></i>
                        <i id="play-pause" class="far fa-play-circle"></i>
                        <i id="forward" class="fas fa-redo"></i>
                    </div>
                    <div id="video-controls-bottom">
                        <span id="video-time"
                            ><span id="current-time"></span> /
                            <span id="video-duration"></span
                        ></span>
                        <span id="right-control">
                            <div id="pitch-mode">
                                <div id="current-mode">Smooth</div>
                                <div id="mode-options">
                                    <p class="mode">Smooth</p>
                                    <p class="mode">Semitone</p>
                                </div>
                            </div>
                            <span id="pitch">
                                <input
                                    type="range"
                                    id="pitch-bar"
                                    min="-1"
                                    max="1"
                                    step="0.01"
                                    value="0"
                                />
                            </span>
                            <span id="volume">
                                <i
                                    id="mute-unmute"
                                    class="fas fa-volume-up"
                                ></i>
                                <input
                                    type="range"
                                    id="volume-bar"
                                    min="0"
                                    max="1"
                                    step="0.1"
                                    value="1"
                                />
                            </span>
                            <i id="fullscreen" class="fas fa-arrows-alt"></i>
                            <div id="playback-speed">
                                <div id="current-speed">1x</div>
                                <div id="speed-options">
                                    <p class="speed">3x</p>
                                    <p class="speed">2.5x</p>
                                    <p class="speed">2x</p>
                                    <p class="speed">1.5x</p>
                                    <p class="speed">1x</p>
                                    <p class="speed">0.75x</p>
                                    <p class="speed">0.50x</p>
                                    <p class="speed">0.25x</p>
                                </div>
                            </div>
                        </span>
                        <input
                            type="range"
                            id="seek-bar"
                            value="0"
                            step="0.5"
                        />
                    </div>
                </div>
                <div class="menu" id="menu-right">
                    <div id="inputs">
                        <input
                            id="url-input"
                            type="url"
                            placeholder="Add url of media..."
                            autocomplete="off"
                            required
                        />
                        <span id="slash">/</span
                        ><i
                            id="add-btn"
                            class="fas fa-plus-circle"
                            title="Add local media"
                        ></i>
                        <input id="file-input" type="file" multiple />
                    </div>
                    <ul id="playlist"></ul>
                    <div id="playlist-options">
                        <i class="fas fa-check-circle"></i>
                        <i class="fas fa-share-alt-square"></i>
                        <a href="https://github.com/riuandg5/video-player"
                            ><i class="fab fa-github"></i
                        ></a>
                    </div>
                </div>
            </div>
        </div>

        <script>
            window.onload = function () {
                const video = document.getElementById("video");
                video.crossOrigin = "anonymous";

                const playPause = document.getElementById("play-pause");
                function videoSource() {
                    return video.src != "";
                }
                function currentItem() {
                    return [
                        ...document.getElementsByClassName("item-index"),
                    ].find(function (item) {
                        return item.url == video.src;
                    });
                }
                function playPreviousItem() {
                    let previousItem =
                        currentItem().parentElement.previousElementSibling;
                    if (previousItem != null) {
                        previousItem
                            .getElementsByClassName("item-index")[0]
                            .click();
                    }
                }
                function playNextItem() {
                    let nextItem =
                        currentItem().parentElement.nextElementSibling;
                    if (nextItem != null) {
                        nextItem
                            .getElementsByClassName("item-index")[0]
                            .click();
                    }
                }
                function activateListNumber(e) {
                    e.getElementsByClassName(
                        "index-number"
                    )[0].classList.remove("hidden");
                    e.getElementsByClassName("fa-play-circle")[0].classList.add(
                        "hidden"
                    );
                    e.getElementsByClassName(
                        "fa-pause-circle"
                    )[0].classList.add("hidden");
                }
                function activateListPauseIcon(e) {
                    e.getElementsByClassName("index-number")[0].classList.add(
                        "hidden"
                    );
                    e.getElementsByClassName("fa-play-circle")[0].classList.add(
                        "hidden"
                    );
                    e.getElementsByClassName(
                        "fa-pause-circle"
                    )[0].classList.remove("hidden");
                }
                function activateListPlayIcon(e) {
                    e.getElementsByClassName("index-number")[0].classList.add(
                        "hidden"
                    );
                    e.getElementsByClassName(
                        "fa-play-circle"
                    )[0].classList.remove("hidden");
                    e.getElementsByClassName(
                        "fa-pause-circle"
                    )[0].classList.add("hidden");
                }
                function activateBothPauseIcon() {
                    playPause.classList.remove("fa-play-circle");
                    playPause.classList.add("fa-pause-circle");
                    activateListPauseIcon(currentItem());
                }
                function activateBothPlayIcon() {
                    playPause.classList.remove("fa-pause-circle");
                    playPause.classList.add("fa-play-circle");
                    activateListPlayIcon(currentItem());
                }
                playPause.addEventListener("click", function () {
                    if (video.paused == true && videoSource()) {
                        video.play();
                        activateBothPauseIcon();
                    } else if (video.paused == false && videoSource()) {
                        video.pause();
                        activateBothPlayIcon();
                    }
                });

                const backward = document.getElementById("backward");
                const forward = document.getElementById("forward");
                backward.addEventListener("click", function () {
                    if (videoSource()) {
                        video.currentTime -= 10;
                        seekBar.value =
                            (100 / video.duration) * video.currentTime;
                    }
                });
                forward.addEventListener("click", function () {
                    if (videoSource()) {
                        video.currentTime += 10;
                        seekBar.value =
                            (100 / video.duration) * video.currentTime;
                    }
                });

                document.addEventListener("keydown", function (e) {
                    switch (e.keyCode) {
                        case 32:
                            playPause.click();
                            break;
                        case 37:
                            if (videoSource()) {
                                video.currentTime -= 10;
                                seekBar.value =
                                    (100 / video.duration) * video.currentTime;
                            }
                            break;
                        case 38:
                            if (videoSource()) {
                                playPreviousItem();
                            }
                            break;
                        case 39:
                            if (videoSource()) {
                                video.currentTime += 10;
                                seekBar.value =
                                    (100 / video.duration) * video.currentTime;
                            }
                            break;
                        case 40:
                            if (videoSource()) {
                                playNextItem();
                            }
                            break;
                        case 70:
                            toggleFullscreen();
                            break;
                        case 77:
                            toggleMute();
                            break;
                        case 187:
                            highSpeed();
                            break;
                        case 189:
                            slowSpeed();
                            break;
                    }
                });

                const currentTime = document.getElementById("current-time");
                const videoDuration = document.getElementById("video-duration");
                function zeroPrefix(num) {
                    return num % 10 == num ? "0" + num : num;
                }
                function timeFormat(time) {
                    const hr = zeroPrefix(parseInt(time / 3600));
                    const min = zeroPrefix(parseInt((time % 3600) / 60));
                    const sec = zeroPrefix(parseInt(time % 60));
                    return `${hr}:${min}:${sec}`;
                }
                currentTime.innerHTML = timeFormat(video.currentTime);
                videoDuration.innerHTML = timeFormat(video.duration);
                video.addEventListener("durationchange", function () {
                    videoDuration.innerHTML = timeFormat(video.duration);
                });
                video.addEventListener("timeupdate", function () {
                    currentTime.innerHTML = timeFormat(video.currentTime);
                    seekBar.value = (video.currentTime * 100) / video.duration;
                });

                const seekBar = document.getElementById("seek-bar");
                seekBar.addEventListener("change", function () {
                    if (videoSource()) {
                        video.currentTime =
                            video.duration * (seekBar.value / 100);
                    }
                });
                seekBar.addEventListener("mousedown", function () {
                    if (videoSource()) {
                        video.pause();
                        activateBothPlayIcon();
                    }
                });
                seekBar.addEventListener("mouseup", function () {
                    if (videoSource()) {
                        video.play();
                        activateBothPauseIcon();
                    } else {
                        seekBar.value = 0;
                    }
                });

                const currentMode = document.getElementById("current-mode");
                currentMode.style.textDecoration = "line-through";
                const modeOptions = document.getElementsByClassName("mode");
                const pitchBar = document.getElementById("pitch-bar");
                let audioContext = null,
                    audioUtil = null,
                    outputNode = null;
                let pitchMode = false;
                function changePitch() {
                    if (!audioUtil) {
                        audioContext = new AudioContext();
                        outputNode =
                            audioContext.createMediaElementSource(video);
                        audioUtil = new AudioUtil(audioContext);
                        audioUtil.output.connect(audioContext.destination);
                        outputNode.connect(audioUtil.input);
                    }
                    audioUtil.setPitchOffset(pitchBar.value, pitchMode);
                    currentMode.style.textDecoration = "none";
                }
                pitchBar.addEventListener("change", changePitch);
                function changeMode() {
                    if (this.textContent === "Semitone") {
                        pitchMode = true;
                        pitchBar.min = -24;
                        pitchBar.max = 24;
                        pitchBar.step = 1;
                        pitchBar.value = 0;
                    } else {
                        pitchMode = false;
                        pitchBar.min = -1;
                        pitchBar.max = 1;
                        pitchBar.step = 0.01;
                        pitchBar.value = 0;
                    }
                    currentMode.innerHTML = this.textContent;
                    changePitch();
                }
                [...modeOptions].forEach(function (mode) {
                    mode.addEventListener("click", changeMode);
                });
                currentMode.addEventListener("click", function () {
                    if (audioUtil) {
                        pitchBar.value = 0;
                        audioUtil.setPitchOffset(pitchBar.value, pitchMode);
                        currentMode.style.textDecoration = "line-through";
                    }
                });

                const volumeBar = document.getElementById("volume-bar");
                const muteUnmute = document.getElementById("mute-unmute");
                function changeVolumeIcon(volume) {
                    if (volume == 0) {
                        muteUnmute.classList.remove("fa-volume-up");
                        muteUnmute.classList.remove("fa-volume-down");
                        muteUnmute.classList.add("fa-volume-mute");
                    } else if (volume > 0 && volume <= 0.5) {
                        muteUnmute.classList.remove("fa-volume-up");
                        muteUnmute.classList.add("fa-volume-down");
                        muteUnmute.classList.remove("fa-volume-mute");
                    } else if (volume >= 0.5 && volume <= 1) {
                        muteUnmute.classList.add("fa-volume-up");
                        muteUnmute.classList.remove("fa-volume-down");
                        muteUnmute.classList.remove("fa-volume-mute");
                    }
                }
                let previousVolume = 0.5;
                function toggleMute() {
                    if (video.volume == 0) {
                        video.volume = previousVolume;
                    } else {
                        previousVolume = video.volume;
                        video.volume = 0;
                    }
                }
                muteUnmute.addEventListener("click", toggleMute);
                video.addEventListener("volumechange", function () {
                    volumeBar.value = video.volume;
                    changeVolumeIcon(volumeBar.value);
                });
                volumeBar.addEventListener("change", function () {
                    video.volume = volumeBar.value;
                    changeVolumeIcon(volumeBar.value);
                });

                const body = document.body;
                const fullscreen = document.getElementById("fullscreen");
                function fullscreenAvailabe() {
                    return (
                        document.fullscreenEnabled ||
                        document.webkitFullscreenEnabled ||
                        document.mozFullscreenEnabled ||
                        document.msFullscreenEnabled
                    );
                }
                function inFullscreen() {
                    return (
                        document.fullscreenElement != null ||
                        document.webkitFullscreenElement != null ||
                        document.mozFullScreenElement != null ||
                        document.msFullscreenElement != null
                    );
                }
                function toggleFullscreen() {
                    if (fullscreenAvailabe()) {
                        if (inFullscreen()) {
                            if (document.exitFullscreen) {
                                document.exitFullscreen();
                            } else if (document.webkitExitFullscreen) {
                                document.webkitExitFullscreen();
                            } else if (document.mozCancelFullScreen) {
                                document.mozCancelFullScreen();
                            } else if (document.msExitFullscreen) {
                                document.msExitFullscreen();
                            }
                        } else {
                            if (body.requestFullscreen) {
                                body.requestFullscreen();
                            } else if (body.mozRequestFullScreen) {
                                body.mozRequestFullScreen();
                            } else if (body.webkitRequestFullScreen) {
                                body.webkitRequestFullScreen();
                            } else if (body.msRequestFullscreen) {
                                body.msRequestFullscreen();
                            }
                        }
                    }
                }
                fullscreen.addEventListener("click", toggleFullscreen);
                const videoControls = document.getElementById("video-controls");
                let timer;
                videoControls.addEventListener("mousemove", function () {
                    clearTimeout(timer);
                    videoControls.style.backgroundColor = "rgba(0, 0, 0, 0.5)";
                    videoControls.style.cursor = "auto";
                    document.getElementById(
                        "video-controls-top"
                    ).style.opacity = "1";
                    document.getElementById(
                        "video-controls-mid"
                    ).style.opacity = "1";
                    document.getElementById(
                        "video-controls-bottom"
                    ).style.opacity = "1";
                    timer = setTimeout(function () {
                        if (videoSource()) {
                            document.getElementById(
                                "video-controls-top"
                            ).style.opacity = "0";
                            document.getElementById(
                                "video-controls-mid"
                            ).style.opacity = "0";
                            document.getElementById(
                                "video-controls-bottom"
                            ).style.opacity = "0";
                            videoControls.style.cursor = "none";
                            videoControls.style.backgroundColor =
                                "rgba(0, 0, 0, 0)";
                        }
                    }, 2500);
                });
                const menuRight = document.getElementById("menu-right");
                menuRight.addEventListener("mousemove", function () {
                    document.getElementById(
                        "video-controls-top"
                    ).style.opacity = "0";
                    document.getElementById(
                        "video-controls-mid"
                    ).style.opacity = "0";
                    document.getElementById(
                        "video-controls-bottom"
                    ).style.opacity = "0";
                });

                const currentSpeed = document.getElementById("current-speed");
                const speedOptions = document.getElementsByClassName("speed");
                function highSpeed() {
                    if (videoSource()) {
                        [...speedOptions].some(function (speed, ind) {
                            if (
                                speed.textContent === currentSpeed.textContent
                            ) {
                                if (ind - 1 >= 0) {
                                    speedOptions[ind - 1].click();
                                }
                                return true;
                            }
                            return false;
                        });
                    }
                }
                function slowSpeed() {
                    if (videoSource()) {
                        [...speedOptions].some(function (speed, ind) {
                            if (
                                speed.textContent === currentSpeed.textContent
                            ) {
                                if (ind + 1 < speedOptions.length) {
                                    speedOptions[ind + 1].click();
                                }
                                return true;
                            }
                            return false;
                        });
                    }
                }
                function changeSpeed() {
                    if (videoSource()) {
                        video.playbackRate = Number(
                            this.textContent.replace(/^\D+|\D+$/g, "")
                        );
                        currentSpeed.innerHTML = this.textContent;
                    }
                }
                [...speedOptions].forEach(function (speed) {
                    speed.addEventListener("click", changeSpeed);
                });

                const urlInput = document.getElementById("url-input");
                const addBtn = document.getElementById("add-btn");
                const fileInput = document.getElementById("file-input");
                addBtn.addEventListener("click", function (e) {
                    e.preventDefault();
                    if (urlInput.value !== "") {
                        addVideo();
                    } else {
                        fileInput.click();
                    }
                });

                const controlsTop =
                    document.getElementById("video-controls-top");
                const playlist = document.getElementById("playlist");
                let templist = [];
                function addVideo() {
                    let startIndex = templist.length;
                    let fileUrl = "";
                    if (paramSrc && video.src !== paramSrc) {
                        fileUrl = paramSrc;
                        templist.push({ name: fileUrl });
                    } else if (urlInput.value !== "") {
                        fileUrl = urlInput.value;
                        urlInput.value = "";
                        templist.push({ name: fileUrl });
                    } else {
                        templist.push(...Array.from(this.files));
                    }
                    for (let i = startIndex; i < templist.length; i++) {
                        let file = templist[i];
                        let listItem = document.createElement("li");
                        listItem.className = "list-item";
                        listItem.innerHTML = `
                        <span class="item-index">
                            <span class="index-number">${i + 1}</span>
                            <i class="fas fa-play-circle hidden"></i>
                            <i class="fas fa-pause-circle hidden"></i>
                        </span>
                        <span class="item-name">${file.name}</span>
                    `;
                        let itemIndex =
                            listItem.getElementsByClassName("item-index")[0];
                        itemIndex.url = fileUrl || URL.createObjectURL(file);
                        itemIndex.addEventListener("click", function () {
                            if (video.src != this.url) {
                                [
                                    ...document.getElementsByClassName(
                                        "item-index"
                                    ),
                                ].forEach(function (item) {
                                    if (item.url != this.url) {
                                        activateListNumber(item);
                                    }
                                });
                                video.src = this.url;
                                controlsTop.innerHTML = file.name;
                                if (!paramSrc) {
                                    playPause.click();
                                    activateListPauseIcon(this);
                                }
                            } else {
                                playPause.click();
                                if (video.paused == true) {
                                    activateListPlayIcon(this);
                                } else {
                                    activateListPauseIcon(this);
                                }
                            }
                        });
                        itemIndex.addEventListener("mouseover", function () {
                            if (video.src != this.url) {
                                activateListPlayIcon(this);
                            }
                        });
                        itemIndex.addEventListener("mouseout", function () {
                            if (video.src != this.url) {
                                activateListNumber(this);
                            }
                        });
                        playlist.appendChild(listItem);
                        if (i == 0) {
                            itemIndex.click();
                        }
                    }
                }
                fileInput.addEventListener("change", addVideo);
                video.addEventListener("ended", function () {
                    playNextItem();
                });

                const params = new Proxy(
                    new URLSearchParams(window.location.search),
                    {
                        get: (searchParams, prop) => searchParams.get(prop),
                    }
                );
                let paramSrc = null;
                if (params.src) {
                    paramSrc = params.src;
                    addVideo();
                    paramSrc = null;
                }
            };
        </script>
    </body>
</html>
